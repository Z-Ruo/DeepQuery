# RAG（检索增强生成）功能实现文档

## 功能概述
本次实现了基于 Milvus 向量数据库与 LangChain4j 的检索增强生成（RAG）问答功能，该功能能够：
1. 从知识库中检索与用户问题语义相关的文档内容
2. 将文档内容与用户问题结合，生成提示发送给大模型
3. 获取大模型回答，并将检索的参考文档作为源信息返回给用户

## 后端实现

### 主要文件和类
1. `RagService.java`: 扩展了原有服务类，添加了 RAG 问答功能
2. `RagController.java`: 添加了 RAG 问答的 API 端点
3. 新增 DTO 类:
   - `RagQuestionRequest.java`: 用户问题请求
   - `RagQuestionResponse.java`: 系统回答响应
   - `RagSourceInfo.java`: 检索到的源文档信息

### 核心功能流程
1. **API 接收请求**：
   - 用户通过 `/v1/rag/question` 端点发送问题，指定要查询的知识库
   - 请求使用 `RagQuestionRequest` 包装参数

2. **检索相关文档**：
   - 使用 `EmbeddingModel` 将用户问题转为向量
   - 通过 Milvus 在指定知识库中检索相关文档片段

3. **构建提示并生成回答**：
   - 将检索到的文档片段格式化为提示模板
   - 通过 `ChatService.askModel()` 方法发送给大模型获取回答
   - 将回答和源文档信息封装为 `RagQuestionResponse` 返回

## 前端实现

### 主要文件和组件
1. `RagQAComponent.vue`: 新增 RAG 问答交互组件
2. 在 `auth.js` 中添加了 RAG 相关 API 调用
3. 在 `Home.vue` 中集成了 RAG 问答功能的入口

### 用户交互流程
1. 用户在界面上切换到"知识库问答"模式
2. 从下拉列表中选择需要查询的知识库
3. 输入问题并发送
4. 系统返回回答，同时显示参考的文档来源

## 使用方法
1. 上传文档到知识库
2. 切换到"知识库问答"选项卡
3. 选择合适的知识库
4. 输入问题并发送
5. 系统会从知识库中检索相关内容，并结合 LLM 生成回答

## 后续优化方向
1. 改进匹配算法，提高检索准确率
2. 添加引用信息溯源功能，将回答中的内容与原文档片段对应
3. 支持多知识库联合查询
4. 改进文档分段策略，处理跨段落语义
5. 添加用户反馈机制，不断优化检索结果
