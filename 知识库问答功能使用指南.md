# 知识库问答功能使用指南

## 功能概述

本系统已完全实现了基于RAG（检索增强生成）的知识库问答功能。该功能允许用户：

1. 选择特定的知识库进行问答
2. 获得基于知识库文档的准确回答
3. 查看回答的参考来源
4. 在RAG失败时自动回退到普通聊天

## 前端界面功能

### 1. 知识库选择面板（左侧）

- **位置**：聊天界面左侧边栏
- **功能**：
  - 显示所有可用知识库列表
  - 支持切换到"直接对话"模式
  - 实时显示当前选中的知识库
  - 提供刷新按钮更新知识库列表

### 2. 参考来源面板

- **触发条件**：当使用知识库问答并找到相关文档时自动显示
- **显示内容**：
  - 文档片段内容
  - 相关度分数
  - 文档标题/文件名
- **交互**：点击关闭按钮可隐藏面板

### 3. 状态指示器

- **模型状态**：显示当前使用的AI模型（智谱AI/Ollama）
- **知识库状态**：显示当前选择的知识库或"直接对话"状态
- **网络状态**：离线时显示警告信息

## 使用流程

### 步骤1：选择知识库
1. 在左侧面板中查看可用知识库列表
2. 点击选择要查询的知识库
3. 或选择"直接对话"进行普通聊天

### 步骤2：提问
1. 在输入框中输入问题
2. 点击发送按钮或按Enter键
3. 系统会根据选择的模式进行处理

### 步骤3：查看回答
1. **知识库问答模式**：
   - 系统从知识库检索相关文档
   - 基于检索结果生成回答
   - 在左侧面板显示参考来源
   
2. **直接对话模式**：
   - 直接使用大模型进行回答
   - 不显示参考来源

## 技术实现

### 前端实现
- **框架**：Vue 3 + Composition API
- **主要文件**：`/src/views/ChatView.vue`
- **API调用**：`/src/api/rag.js`

### 后端实现
- **API端点**：`/v1/rag/question`
- **核心服务**：`RagService.answerQuestion()`
- **向量数据库**：Milvus
- **嵌入模型**：LangChain4j集成

### 关键功能
1. **智能检索**：使用语义相似度检索相关文档
2. **上下文构建**：将检索结果格式化为结构化提示
3. **回答生成**：结合知识库内容生成准确回答
4. **来源追踪**：记录并返回参考文档信息

## 错误处理

1. **网络错误**：显示网络状态，提供重试功能
2. **RAG失败**：自动回退到普通聊天模式
3. **知识库为空**：显示友好提示信息
4. **参数验证**：前后端双重参数校验

## 配置参数

### 前端配置
- `maxResults`：默认检索3个最相关文档
- `enableTypewriterEffect`：控制打字机效果
- `timeout`：请求超时时间60秒

### 后端配置
- 向量维度：768（默认）
- 相似度阈值：0.0（可调整）
- 最大文档大小：10MB

## 性能优化

1. **前端优化**：
   - 响应式布局
   - 懒加载知识库列表
   - 实时流式显示
   - 滚动性能优化

2. **后端优化**：
   - 文档分段策略
   - 向量检索优化
   - 缓存机制
   - 错误恢复

## 注意事项

1. **知识库准备**：使用前需确保知识库包含相关文档
2. **问题类型**：最适合基于文档的事实性问答
3. **语言支持**：主要支持中文问答
4. **文档格式**：支持PDF、DOC、DOCX、TXT格式

## 故障排除

### 常见问题

1. **知识库列表为空**
   - 检查后端服务是否运行
   - 确认Milvus连接正常
   - 验证知识库是否已创建

2. **RAG问答失败**
   - 检查知识库是否包含相关文档
   - 验证API连接状态
   - 查看控制台错误信息

3. **参考来源不显示**
   - 确认检索到相关文档
   - 检查sources数据结构
   - 验证相关度分数阈值

## 扩展功能

未来可以考虑的功能扩展：

1. **多知识库联合查询**
2. **文档上传界面集成**
3. **搜索历史记录**
4. **回答质量评分**
5. **自定义检索参数**

---

*本文档基于当前实现版本编写，如有更新请及时同步。*
